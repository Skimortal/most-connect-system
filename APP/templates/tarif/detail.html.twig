{% extends 'base_logged_in.html.twig' %}

{% block title %}{{ 'tarif_detail_title'|trans }}{% endblock %}

{% block logged_in_content %}
    <h1 class="mb-4">{{ 'tarif_detail_title'|trans }}</h1>

    {% form_theme form 'form/adminator_bootstrap_5_layout.html.twig' %}

    {% for label, messages in app.flashes(['success', 'danger', 'warning', 'info']) %}
        {% for message in messages %}
            <div class="alert alert-{{ label }} alert-dismissible fade show" role="alert">
                {{ message|raw }}
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
        {% endfor %}
    {% endfor %}

    {{ form_start(form, { attr: { 'data-turbo': 'false' } }) }}

    {{ form_row(form.name) }}
    {{ form_row(form.validFrom) }}
    {{ form_row(form.validTo) }}
    {{ form_row(form.description) }}
    {{ form_row(form.furtherInfo) }}

    <div class="bd bgc-white p-20 mt-5 mb-5">
        <div class="layers">
            <div class="layer w-100 mB-10">
                <h6 class="lh-1">{{ 'tarif_positions'|trans }}</h6>
                {{ form_errors(form.positions) }}
            </div>

            <div class="layer w-100"
                 data-controller="form-collection"
                 data-form-collection-index-value="{{ form.positions|length }}">

                <template data-form-collection-target="prototype">
                    <tr data-collection-item>
                        <td><span data-collection-counter>__n__</span></td>
                        <td>{{ form_widget(form.positions.vars.prototype.category) }}</td>
                        <td>{{ form_widget(form.positions.vars.prototype.numberLabel) }}</td>
                        <td>{{ form_widget(form.positions.vars.prototype.name) }}</td>
                        <td>{{ form_widget(form.positions.vars.prototype.tarifValue) }}</td>
                        <td><button type="button" class="btn btn-outline-danger confirmRemoveItem" data-action="click->form-collection#remove" data-confirm-message="{{ 'confirm_remove'|trans }}">{{ 'remove'|trans }}</button></td>
                    </tr>
                </template>

                <table class="table table-bordered">
                    <thead>
                    <tr>
                        <th scope="col">#</th>
                        <th scope="col" style="width: 20%;">{{ 'category.label'|trans }}</th>
                        <th scope="col" style="width: 10%;">{{ 'numberLabel.label'|trans }}</th>
                        <th scope="col" style="width: 50%;">{{ 'name.label'|trans }}</th>
                        <th scope="col" style="width: 10%;">{{ 'tarifValue.label'|trans }}</th>
                        <th scope="col" style="width: 10%;">{{ 'action'|trans }}</th>
                    </tr>
                    </thead>

                    <tbody data-form-collection-target="list">
                    {% for positionForm in form.positions %}
                        <tr data-collection-item>
                            <td scope="row"><span data-collection-counter>{{ loop.index }}</span></td>
                            <td>{{ form_widget(positionForm.category) }}</td>
                            <td>{{ form_widget(positionForm.numberLabel) }}</td>
                            <td>{{ form_widget(positionForm.name) }}</td>
                            <td>{{ form_widget(positionForm.tarifValue) }}</td>
                            <td>
                                <button type="button"
                                        class="btn btn-outline-danger confirmRemoveItem"
                                        data-action="click->form-collection#remove"
                                        data-confirm-message="{{ 'confirm_remove'|trans }}">
                                    {{ 'remove'|trans }}
                                </button>
                            </td>
                        </tr>
                    {% endfor %}
                    </tbody>

                    <tfoot>
                    <tr>
                        <td colspan="7">
                            <button type="button"
                                    class="btn btn-success mt-3"
                                    data-action="click->form-collection#add">
                                {{ 'addTarifPosition'|trans }}
                            </button>
                        </td>
                    </tr>
                    </tfoot>
                </table>
            </div>
        </div>
    </div>

    <div class="mt-3 row">
        <div class="col-sm-8">
            <a href="{{ path('tarif_list') }}" class="btn btn-secondary">{{ 'back_to_list'|trans }}</a>
            <button type="submit" class="btn btn-primary">{{ 'save'|trans }}</button>
        </div>
        <div class="col-sm-4" style="text-align: right;">
            {% if tarif.id and is_granted('ROLE_ADMIN') %}
                <a href="{{ path('tarif_delete', {'id': tarif.id}) }}" class="btn btn-danger confirmRemoveItem" data-confirm-message="{{ 'confirm_remove'|trans }}">{{ 'delete'|trans }}</a>
            {% endif %}
        </div>
    </div>

    {{ form_widget(form._token) }}
    {{ form_end(form, { 'render_rest': false }) }}

{% endblock %}
